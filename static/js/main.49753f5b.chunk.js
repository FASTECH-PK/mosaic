(this.webpackJsonpmosaic=this.webpackJsonpmosaic||[]).push([[0],{17:function(e,t,n){},18:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),c=n(11),o=n.n(c),a=(n(17),n(18),n(6)),s=n(5),u=n(2),f=n(4),l=n.n(f),d=n(7),h=n(8),p=n(1),v=function(e){var t=e.text,n=e.style,i=e.onClick,c=e.title,o=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=function(e){e.stopPropagation()};return o.current.addEventListener("pointerdown",e),function(){o.current&&o.current.removeEventListener("pointerdown",e)}}),[]),Object(r.useEffect)((function(){var e=function(e){e.stopPropagation(),i(e)};return o.current.addEventListener("click",e),function(){o.current&&o.current.removeEventListener("click",e)}}),[]),Object(p.jsx)("div",{ref:o,role:"button",title:c,style:Object(h.a)(Object(h.a)({},n),{},{height:32,lineHeight:"32px",minWidth:32,padding:"0 8px",textAlign:"center",pointerEvents:"auto"}),className:"button",children:t})},w=function(e,t){var n=Object(r.useRef)(new u.h);Object(r.useEffect)((function(){var r=e.current,i=function(e){e.preventDefault();var i=r.clientWidth,c=r.clientHeight;n.current.copy(t.position);var o=(c-e.deltaY)/c,a=Math.min(32,Math.max(1,t.position.z/o)),s=2*Math.tan(t.fov*Math.PI/360)*n.current.z/c,u=e.clientX-r.offsetLeft-i/2,f=-(e.clientY-r.offsetTop-c/2),l=u*s,d=f*s,h=2*Math.tan(t.fov*Math.PI/360)*a/c,p=u*h-l,v=f*h-d;t.position.x=n.current.x-p,t.position.y=n.current.y-v,t.position.z=a};if(r)return r.addEventListener("wheel",i,{passive:!1}),function(){r.removeEventListener("wheel",i)}}),[e,t])},b=function(e,t){var n=Object(r.useRef)(new u.h),i=Object(r.useRef)(new u.g),c=Object(r.useRef)([]);Object(r.useEffect)((function(){var r=e.current,o=c.current,s=function(e){e.preventDefault(),o.push({id:e.pointerId,x:e.clientX-r.offsetLeft,y:e.clientY-r.offsetTop,pointerDown:[e.clientX-r.offsetLeft,e.clientY-r.offsetTop],primary:e.isPrimary});var i,c=Object(a.a)(o);try{for(c.s();!(i=c.n()).done;){var s=i.value;s.pointerDown=[s.x,s.y]}}catch(u){c.e(u)}finally{c.f()}n.current.copy(t.position),r.setPointerCapture(e.pointerId)},f=function(e){e.preventDefault();var c=r.clientWidth,a=r.clientHeight;if(1===o.length){var s=o[0];s.x=e.clientX-r.offsetLeft,s.y=e.clientY-r.offsetTop;var f=2*Math.tan(t.fov*Math.PI/360)*n.current.z/a;i.current.x=(e.clientX-r.offsetLeft-s.pointerDown[0])*f,i.current.y=(e.clientY-r.offsetTop-s.pointerDown[1])*f,t.position.x=n.current.x-i.current.x,t.position.y=n.current.y+i.current.y}else if(2===o.length){var l=o.filter((function(t){return t.id===e.pointerId}))[0];l.x=e.clientX-r.offsetLeft,l.y=e.clientY-r.offsetTop;var d=o[0],h=o[1],p=[Math.min(d.pointerDown[0],h.pointerDown[0]),Math.min(d.pointerDown[1],h.pointerDown[1])],v=[Math.max(d.pointerDown[0],h.pointerDown[0]),Math.max(d.pointerDown[1],h.pointerDown[1])],w=[Math.min(d.x,h.x),Math.min(d.y,h.y)],b=[Math.max(d.x,h.x),Math.max(d.y,h.y)],j={down:[p[0]+(v[0]-p[0])/2,p[1]+(v[1]-p[1])/2],current:[w[0]+(b[0]-w[0])/2,w[1]+(b[1]-w[1])/2]},g=2*Math.tan(t.fov*Math.PI/360)*n.current.z/a,O=[(j.current[0]-j.down[0])*g,(j.current[1]-j.down[1])*g],m=new u.h;m.x=n.current.x-O[0],m.y=n.current.y+O[1];var x=Math.sqrt(Math.pow(d.pointerDown[0]-h.pointerDown[0],2)+Math.pow(d.pointerDown[1]-h.pointerDown[1],2)),y=(Math.sqrt(Math.pow(d.x-h.x,2)+Math.pow(d.y-h.y,2))-x)/x+1,R=j.current[0]-c/2,E=-(j.current[1]-a/2),I=R*g,C=E*g,L=Math.min(32,Math.max(1,n.current.z/y)),M=2*Math.tan(t.fov*Math.PI/360)*L/a,k=R*M-I,S=E*M-C;t.position.x=m.x-k,t.position.y=m.y-S,t.position.z=L}},l=function(e){e.preventDefault(),o.splice(o.findIndex((function(t){return t.id===e.pointerId})),1);var i,c=Object(a.a)(o);try{for(c.s();!(i=c.n()).done;){var s=i.value;s.pointerDown=[s.x,s.y]}}catch(u){c.e(u)}finally{c.f()}n.current.copy(t.position),r.releasePointerCapture(e.pointerId)};if(r)return r.addEventListener("pointerdown",s),r.addEventListener("pointermove",f),r.addEventListener("pointerup",l),function(){r.removeEventListener("pointerdown",s),r.removeEventListener("pointermove",f),r.removeEventListener("pointerup",l)}}),[e,t])},j=n(22),g=800,O=16,m=function(e){var t=e.camera,n=e.box,i=e.scene,c=e.setSrcInfo,o=e.srcCanvasRef,f=e.srcCanvasTextureRef,h=e.srcPlaneRef,m=e.setSrcId,x=e.srcInfo,y=e.activeRef,R=e.pasteSrc,E=Object(r.useRef)(null),I=Object(r.useRef)(null),C=Object(r.useRef)(null),L=Object(r.useState)(""),M=Object(s.a)(L,2),k=M[0],S=M[1];Object(r.useEffect)((function(){t.position.z=0;var e=o.current||document.createElement("canvas");o.current=e,e.width=64,e.height=64;var n=new u.a(e);f.current=n;var r=new u.e(6,6),c=new u.c({map:n}),a=new u.b(r,c);h.current=a,i.add(a),t.position.z=8}),[]),Object(r.useEffect)((function(){R&&z(R)}),[R]);var D=Object(r.useRef)(0),z=function(e){D.current++;var t=new Image,n=Object(j.a)();m(n),t.onload=function(){var e=D.current,r=Math.round(t.width/O),i=Math.round(t.height/O),a=r*O,s=i*O;S("".concat(a,"x").concat(s));var l=h.current;l.scale.x=t.width/g,l.scale.y=t.height/g;var d=E.current||document.createElement("canvas");E.current=d,d.width=a,d.height=s,d.getContext("2d").drawImage(t,0,0,d.width,d.height);var p=[],v=I.current||document.createElement("canvas");v.width=2*r,v.height=2*i;var w=v.getContext("2d");w.drawImage(t,0,0,v.width,v.height);var b=o.current;b.width=a,b.height=s,f.current=new u.a(b),l.material.map=f.current;var j=b.getContext("2d");j.fillStyle="#111",j.fillRect(0,0,b.width,b.height);var m=Array(r*i).fill(0).map((function(e,t){return t}));!function o(){for(var a=0;a<16;a++){var s=m.shift();if(void 0!==s){for(var u=s%r,l=Math.floor(s/r),d=w.getImageData(2*u,2*l,2,2).data,h=[],v=0;v<16;v+=4){var b=[d[v],d[v+1],d[v+2]];h.push(b)}p.push(h),j.drawImage(t,u*O,l*O,O,O,u*O,l*O,O,O),f.current.needsUpdate=!0,0===m.length&&(console.log("set src"),c({id:n,cols:r,rows:i,lookups:p}))}15===a&&D.current===e&&setTimeout((function(){o()}),0)}}()},t.src=e};Object(r.useEffect)((function(){z("/minidisc.jpg?=2")}),[]),Object(r.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(d.a)(l.a.mark((function e(){var t,n,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(a.a)(this.files),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=11;break}if(!((r=n.value).type.indexOf("image")<0)){e.next=7;break}return e.abrupt("continue",9);case 7:i=URL.createObjectURL(r),z(i);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),t.e(e.t0);case 16:return e.prev=16,t.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,13,16,19]])})))).apply(this,arguments)}return C.current.addEventListener("change",e),function(){C.current.removeEventListener("change",e)}}),[]);var P=Object(r.useRef)(null);return w(P,t),b(P,t),Object(r.useEffect)((function(){x&&S("".concat(x.cols*O,"x").concat(x.rows*O))}),[x]),Object(p.jsxs)("div",{ref:P,className:"portion",onPointerDown:function(){return y.current=2},style:{position:"absolute",bottom:n.top,left:n.left,width:n.width,height:n.height,color:"#ddd",zIndex:1},children:[Object(p.jsx)("div",{style:{padding:"12px 8px"},children:"SRC"}),Object(p.jsx)("input",{type:"file",ref:C,accept:".jpg,.png,.jpeg",style:{display:"none"}}),Object(p.jsxs)("div",{style:{position:"absolute",left:0,right:0,bottom:0,display:"flex",justifyContent:"space-between",alignItems:"center",padding:16},children:[Object(p.jsx)("div",{className:"readout",children:k}),Object(p.jsx)(v,{text:"\u2191",title:"Upload image",onClick:function(){C.current.dispatchEvent(new PointerEvent("click",{bubbles:!0,cancelable:!0,view:window}))}})]})]})},x=16,y=function(e){var t=e.camera,n=e.box,i=e.scene,c=e.setDstInfo,o=e.dstCanvasRef,f=e.swapInfo,h=e.dstCanvasTextureRef,O=e.dstPlaneRef,m=e.setDstId,y=e.dstInfo,R=e.activeRef,E=e.pasteSrc,I=e.srcInfo,C=e.srcId,L=e.dstId,M=Object(r.useRef)(null),k=Object(r.useRef)(null),S=Object(r.useRef)(null),D=Object(r.useState)(""),z=Object(s.a)(D,2),P=z[0],T=z[1];Object(r.useEffect)((function(){t.position.z=0;var e=o.current||document.createElement("canvas");o.current=e,e.width=64,e.height=64;var n=e.getContext("2d");n.fillStyle="#fff",n.fillRect(0,0,e.width,e.height);var r=new u.a(e);h.current=r;var c=new u.e(6,6),a=new u.c({map:r}),s=new u.b(c,a);O.current=s,i.add(s),t.position.z=8}),[]),Object(r.useEffect)((function(){E&&H(E)}),[E]);var U=Object(r.useRef)(0),H=function(e){U.current++;var t=new Image,n=Object(j.a)();m(n),t.onload=function(){var e=U.current,r=Math.round(t.width/x),i=Math.round(t.height/x),a=r*x,s=i*x;T("".concat(a,"x").concat(s));var f=O.current;f.scale.x=t.width/g,f.scale.y=t.height/g;var l=S.current||document.createElement("canvas");S.current=l,l.width=a,l.height=s,l.getContext("2d").drawImage(t,0,0,l.width,l.height);var d=[],p=k.current||document.createElement("canvas");p.width=2*r,p.height=2*i;var v=p.getContext("2d");v.drawImage(t,0,0,p.width,p.height);var w=o.current;w.width=a,w.height=s,h.current=new u.a(w),f.material.map=h.current;var b=w.getContext("2d");b.fillStyle="#111",b.fillRect(0,0,w.width,w.height);var j=Array(r*i).fill(0).map((function(e,t){return t}));!function o(){for(var a=0;a<16;a++){var s=j.shift();if(void 0!==s){for(var u=s%r,f=Math.floor(s/r),l=v.getImageData(2*u,2*f,2,2).data,p=[],w=0;w<16;w+=4){var g=[l[w],l[w+1],l[w+2]];p.push(g)}d.push(p),b.drawImage(t,u*x,f*x,x,x,u*x,f*x,x,x),h.current.needsUpdate=!0,0===j.length&&c({id:n,cols:r,rows:i,lookups:d})}15===a&&U.current===e&&setTimeout((function(){o()}),0)}}()},t.src=e};Object(r.useEffect)((function(){H("/computers.jpg?=1")}),[]),Object(r.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(d.a)(l.a.mark((function e(){var t,n,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(a.a)(this.files),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=11;break}if(!((r=n.value).type.indexOf("image")<0)){e.next=7;break}return e.abrupt("continue",9);case 7:i=URL.createObjectURL(r),H(i);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),t.e(e.t0);case 16:return e.prev=16,t.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,13,16,19]])})))).apply(this,arguments)}return M.current.addEventListener("change",e),function(){M.current.removeEventListener("change",e)}}),[]),Object(r.useEffect)((function(){y&&T("".concat(y.cols*x,"x").concat(y.rows*x))}),[y]);var A=Object(r.useRef)(null);return w(A,t),b(A,t),Object(p.jsxs)("div",{ref:A,className:"portion",style:{position:"absolute",bottom:n.top,left:n.left,width:n.width,height:n.height,color:"#ddd",outline:"1px solid #3333",zIndex:1},onPointerDown:function(){return R.current=2},children:[Object(p.jsx)("div",{style:{padding:"12px 8px"},children:"DST"}),Object(p.jsx)("input",{type:"file",ref:M,accept:".jpg,.png,.jpeg",style:{display:"none"}}),Object(p.jsx)("div",{style:{position:"absolute",left:0,right:0,top:0,display:"flex",justifyContent:"end",alignItems:"center",padding:16}}),Object(p.jsxs)("div",{style:{position:"absolute",left:0,right:0,bottom:0,display:"flex",justifyContent:"space-between",alignItems:"center",padding:16},children:[Object(p.jsx)("div",{className:"readout",children:P}),Object(p.jsxs)("div",{style:{display:"flex",gap:16},children:[I&&I.id===C&&y&&y.id===L?Object(p.jsx)(v,{text:"\u2195",title:"Swap src and dst",style:{transformOrigin:"center center",transform:"rotate(90deg)"},onClick:function(){f()}}):null,Object(p.jsx)(v,{text:"\u2191",title:"Upload image",onClick:function(){M.current.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}})]})]})]})},R=16,E=function(e){var t=e.camera,n=e.box,i=e.scene,c=e.srcInfo,o=e.dstInfo,a=e.srcCanvasRef,f=e.dstId,h=e.srcId,j=e.activeRef,O=Object(r.useRef)(null),m=Object(r.useRef)(null),x=Object(r.useRef)(null),y=Object(r.useState)(""),E=Object(s.a)(y,2),I=E[0],C=E[1],L=Object(r.useState)(!1),M=Object(s.a)(L,2),k=M[0],S=M[1];Object(r.useEffect)((function(){t.position.z=0;var e=O.current||document.createElement("canvas");O.current=e,e.width=64,e.height=64;var n=new u.a(e);m.current=n;var r=new u.e(6,6),c=new u.c({map:n}),o=new u.b(r,c);x.current=o,i.add(o),t.position.z=8}),[]);var D=Object(r.useRef)(0);Object(r.useEffect)((function(){if(S(!1),c&&o){D.current++,console.log("regen");var e=o.cols*R,t=o.rows*R;C("".concat(e,"x").concat(t));var n=x.current;n.scale.x=e/g,n.scale.y=t/g;var r=O.current;r.width=e,r.height=t;var i=r.getContext("2d");i.fillStyle="#111",i.fillRect(0,0,e,t),x.current.material.map=new u.a(r),x.current.material.needsUpdate=!0;var s=Array(o.cols*o.rows).fill(0).map((function(e,t){return t})),l=D.current;!function e(){if(D.current===l&&h===c.id&&f===o.id)for(var t=0;t<8;t++){var n=s.shift();if(void 0!==n){for(var r=n%o.cols,u=Math.floor(n/o.cols),d=1/0,p=-1,v=o.lookups[n],w=0;w<c.cols*c.rows;w++){for(var b=c.lookups[w],j=0,g=function(e){var t=b[e],n=v[e].map((function(e,n){return Math.abs(e-t[n])})).reduce((function(e,t){return e+t}),0);j+=n},O=0;O<4;O++)g(O);j<d&&(d=j,p=w)}var m=p%c.cols,y=Math.floor(p/c.cols);i.drawImage(a.current,m*R,y*R,R,R,r*R,u*R,R,R),x.current.material.map.needsUpdate=!0,0===s.length&&(console.log("done"),S(!0))}7===t&&setTimeout((function(){e()}),0)}}()}}),[c,o,h,f]);var z=Object(r.useRef)(null);return w(z,t),b(z,t),Object(p.jsx)("div",{ref:z,className:"portion",onPointerDown:function(){return j.current=2},style:{position:"absolute",bottom:n.top,left:n.left,width:n.width,height:n.height,color:"#ddd"},children:Object(p.jsxs)("div",{style:{position:"absolute",left:0,right:0,bottom:0,display:"flex",justifyContent:"space-between",alignItems:"center",padding:16,height:64},children:[Object(p.jsx)("div",{className:"readout",children:I}),k?Object(p.jsx)(v,{text:"\u2193",title:"Download image",onClick:function(){O.current.toBlob(function(){var e=Object(d.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=URL.createObjectURL(t),(r=document.createElement("a")).setAttribute("download","mosaic-"+Math.round((new Date).getTime()/1e3)+".png"),r.setAttribute("href",n),r.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}):Object(p.jsx)("div",{style:{color:"#888"},children:"processing..."})]})})};var I=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],i=t[1],c=Object(r.useRef)(null),o=Object(r.useRef)([]),f=Object(r.useState)([]),l=Object(s.a)(f,2),d=l[0],h=l[1],w=Object(r.useState)(null),b=Object(s.a)(w,2),j=b[0],O=b[1],x=Object(r.useState)(null),R=Object(s.a)(x,2),I=R[0],C=R[1],L=Object(r.useState)(null),M=Object(s.a)(L,2),k=M[0],S=M[1],D=Object(r.useState)(null),z=Object(s.a)(D,2),P=z[0],T=z[1],U=Object(r.useState)(!1),H=Object(s.a)(U,2),A=H[0],N=H[1],F=Object(r.useRef)(null),X=Object(r.useRef)(null),Y=Object(r.useRef)([]),W=Object(r.useRef)([]),B=Object(r.useRef)(null),J=Object(r.useRef)(null),V=Object(r.useRef)(null),q=Object(r.useRef)(null),K=Object(r.useRef)(null),_=Object(r.useRef)(null),G=Object(r.useRef)(0),Q=Object(r.useState)(null),Z=Object(s.a)(Q,2),$=Z[0],ee=Z[1],te=Object(r.useState)(null),ne=Object(s.a)(te,2),re=ne[0],ie=ne[1],ce=Object(r.useRef)([]),oe=function(){var e=window.innerWidth,t=window.innerHeight;o.current=e>t?[{left:0,top:t/2,width:e/2,height:t/2},{left:0,top:0,width:e/2,height:t/2},{left:e/2,top:0,width:e/2,height:t}]:[{left:0,top:t/2,width:e/2,height:t/2},{left:e/2,top:t/2,width:e/2,height:t/2},{left:0,top:0,width:e,height:t/2}],console.log("set layout")};oe();var ae=Object(r.useRef)(j),se=Object(r.useRef)(I);return Object(r.useEffect)((function(){ae.current=j,se.current=I}),[j,I]),Object(r.useEffect)((function(){var e=o.current,t=Object(s.a)(e,3),n=t[0],r=t[1],a=t[2],f=new u.d(75,n.width/n.height,.1,1e3),l=new u.d(75,r.width/r.height,.1,1e3),d=new u.d(75,a.width/a.height,.1,1e3);W.current=[f,l,d];var h=new u.i({canvas:c.current});B.current=h,h.setSize(window.innerWidth,window.innerHeight),h.setPixelRatio(window.devicePixelRatio);var p=new u.f,v=new u.f,w=new u.f;Y.current=[p,v,w];var b=new u.e(1,1),j=new u.c({color:0}),g=new u.b(b,j);v.add(g);var O=new u.e(1,1),m=new u.c({color:0}),x=new u.b(O,m);w.add(x),f.position.z=5,l.position.z=5,d.position.z=5,h.autoClear=!1,i(!0)}),[]),Object(r.useEffect)((function(){!function e(){var t=B.current;t.clear();var n=o.current,r=Object(s.a)(n,3),i=r[0],c=r[1],a=r[2],u=W.current,f=Object(s.a)(u,3),l=f[0],d=f[1],h=f[2],p=Y.current,v=Object(s.a)(p,3),w=v[0],b=v[1],j=v[2],g=i.left,O=i.top,m=i.width,x=i.height;t.setScissor(g,O,m,x),t.setViewport(g,O,m,x),t.render(w,l);var y=c.left,R=c.top,E=c.width,I=c.height;t.setScissor(y,R,E,I),t.setViewport(y,R,E,I),t.render(b,d);var C=a.left,L=a.top,M=a.width,k=a.height;t.setScissor(C,L,M,k),t.setViewport(C,L,M,k),t.render(j,h),requestAnimationFrame(e)}()}),[]),Object(r.useEffect)((function(){var e=function(){oe();for(var e=o.current,t=0;t<e.length;t++){var n=e[t],r=W.current[t];r.aspect=n.width/n.height,r.updateProjectionMatrix()}B.current.setSize(window.innerWidth,window.innerHeight),h(e)};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),Object(r.useEffect)((function(){var e=function(e){if(o.current){var t,n=0,r=Object(a.a)(o.current);try{for(r.s();!(t=r.n()).done;){var i=t.value,c=e.clientX,s=window.innerHeight-e.clientY;if(c>=i.left&&c<=i.left+i.width&&s>=i.top&&s<=i.top+i.height){G.current=n;break}n++}}catch(u){r.e(u)}finally{r.f()}}};return window.addEventListener("pointermove",e),function(){return window.removeEventListener("pointermove",e)}}),[]),Object(r.useEffect)((function(){var e=function(e){var t=G;e.preventDefault(),e.stopPropagation();var n,r=Object(a.a)(e.clipboardData.items);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!(i.type.indexOf("image")<0)){var c=i.getAsFile(),o=URL.createObjectURL(c);0===t.current?ee(o):1===t.current?ie(o):alert("Choose the SRC or DST block to paste to")}}}catch(s){r.e(s)}finally{r.f()}},t=function(e){var t=G;e.preventDefault(),e.stopPropagation();var n=e.dataTransfer.files[0],r=URL.createObjectURL(n);0===t.current?ee(r):1===t.current?ie(r):alert("Drag to the SRC or DST block")},n=function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"};return window.addEventListener("paste",e),window.addEventListener("dragover",n),window.addEventListener("drop",t),function(){window.removeEventListener("paste",e),window.removeEventListener("dragover",n),window.removeEventListener("drop",t)}}),[]),Object(r.useEffect)((function(){var e=ce.current,t=function(e){var t=W.current[G.current],n=2*Math.tan(t.fov*Math.PI/360)*t.position.z/window.innerHeight;t.position.x-=16*e[0]*n,t.position.y+=16*e[1]*n},n=function(e){var t=W.current[G.current],n=(window.innerHeight-e)/window.innerHeight;t.position.z=Math.min(32,Math.max(1,t.position.z/n))},r=function(r){var i=r.key.toLowerCase();"escape"===i&&N(!1),"-"===i?n(64):"+"!==i&&"="!==i||n(-64),e.includes(i)||e.push(i),(e.includes("arrowleft")||e.includes("h"))&&t([2,0]),(e.includes("arrowright")||e.includes("l"))&&t([-2,0]),(e.includes("arrowup")||e.includes("k"))&&(r.shiftKey?n(64):t([0,2])),(e.includes("arrowdown")||e.includes("j"))&&(r.shiftKey?n(-64):t([0,-2]))},i=function(t){var n=t.key.toLowerCase(),r=e.indexOf(n);-1!==r&&e.splice(r,1)};return window.addEventListener("keydown",r),window.addEventListener("keyup",i),function(){window.removeEventListener("keydown",r),window.removeEventListener("keyup",i)}}),[]),Object(p.jsxs)(p.Fragment,{children:[n?Object(p.jsxs)(p.Fragment,{children:[d[0]?Object(p.jsx)(m,{scene:Y.current[0],camera:W.current[0],box:d[0],setSrcInfo:O,srcCanvasRef:F,srcCanvasTextureRef:J,srcPlaneRef:q,setSrcId:S,srcInfo:j,activeRef:G,pasteSrc:$}):null,d[1]?Object(p.jsx)(y,{scene:Y.current[1],camera:W.current[1],box:d[1],setDstInfo:C,dstCanvasRef:X,swapInfo:function(){var e=F.current,t=X.current;_.current=_.current||document.createElement("canvas");var n=_.current;n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0);var r=JSON.parse(JSON.stringify(ae.current));e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),J.current=new u.a(e),q.current.material.map=J.current;var i=q.current;i.scale.x=e.width/g,i.scale.y=e.height/g,S(se.current.id),O(se.current),t.width=n.width,t.height=n.height,t.getContext("2d").drawImage(n,0,0),V.current=new u.a(t),K.current.material.map=V.current;var c=K.current;c.scale.x=t.width/g,c.scale.y=t.height/g,T(r.id),C(r)},dstCanvasTextureRef:V,dstPlaneRef:K,setDstId:T,dstInfo:I,srcInfo:j,srcId:k,dstId:P,activeRef:G,pasteSrc:re}):null,d[1]?Object(p.jsx)(E,{scene:Y.current[2],camera:W.current[2],box:d[2],srcId:k,dstId:P,srcInfo:j,dstInfo:I,srcCanvasRef:F,activeRef:G}):null]}):null,Object(p.jsx)("canvas",{ref:c}),Object(p.jsx)("div",{style:{position:"absolute",top:0,right:0,padding:16,justifyContent:"end",pointerEvents:"none",zIndex:2},children:Object(p.jsx)(v,{text:"About",onClick:function(){return N(!A)}})}),Object(p.jsx)("div",{style:{display:A?"flex":"none",position:"fixed",left:0,top:0,width:"100%",height:"100%",justifyContent:"center",alignItems:"center",zIndex:3},onClick:function(){return N(!1)},children:Object(p.jsxs)("div",{style:{background:"#222",maxWidth:440,width:"100%",fontSize:"16px",lineHeight:"24px",color:"#ddd"},onClick:function(e){return e.stopPropagation()},children:[Object(p.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",padding:"16px 16px",borderBottom:"1px solid #444",position:"relative"},children:[Object(p.jsx)("div",{children:"About"}),Object(p.jsx)("div",{role:"button",style:{padding:16,position:"absolute",right:0,top:0,cursor:"pointer"},onClick:function(){return N(!1)},children:"X"})]}),Object(p.jsxs)("div",{style:{padding:16},children:[Object(p.jsx)("div",{style:{marginBottom:16},children:"Recreate one image using the tiles from another image."}),Object(p.jsxs)("div",{style:{marginBottom:16},children:["from"," ",Object(p.jsx)("a",{href:"https://constraint.systems/",target:"_blank",children:"Constraint Systems"})]}),Object(p.jsx)("div",{children:Object(p.jsx)("a",{href:"https://github.com/constraint-systems/mosaic",target:"_blank",children:"View source"})})]})]})})]})},C=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,23)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),i(e),c(e),o(e)}))};o.a.render(Object(p.jsx)(i.a.StrictMode,{children:Object(p.jsx)(I,{})}),document.getElementById("root")),C()}},[[21,1,2]]]);
//# sourceMappingURL=main.49753f5b.chunk.js.map